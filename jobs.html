<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skysoft Job Market</title>
    <script src="https://cdn.jsdelivr.net/npm/ipfs/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dat-sdk@1.0.0/dist/bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/peer-id@1.0.0/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/libp2p@0.32.0/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/libp2p-webrtc-star@0.24.0/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/libp2p-bootstrap@0.15.0/dist/index.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --info-color: #3498db;
            --border-radius: 5px;
            --box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 0;
            box-shadow: var(--box-shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
        }

        .nav-links {
            display: flex;
            gap: 20px;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            padding: 5px 10px;
            border-radius: var(--border-radius);
            transition: background-color 0.3s;
        }

        .nav-links a:hover {
            background-color: var(--secondary-color);
        }

        .auth-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
        }

        .btn-secondary {
            background-color: var(--light-color);
            color: var(--dark-color);
        }

        .btn-secondary:hover {
            background-color: #ddd;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #27ae60;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--box-shadow);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .modal-title {
            font-size: 20px;
            font-weight: bold;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #777;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 16px;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .text-center {
            text-align: center;
        }

        .mt-3 {
            margin-top: 15px;
        }

        .d-flex {
            display: flex;
        }

        .justify-content-between {
            justify-content: space-between;
        }

        .align-items-center {
            align-items: center;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .sidebar {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 15px;
            box-shadow: var(--box-shadow);
            height: fit-content;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 10px;
        }

        .sidebar-menu a {
            display: block;
            padding: 8px 10px;
            color: var(--dark-color);
            text-decoration: none;
            border-radius: var(--border-radius);
            transition: background-color 0.3s;
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: var(--light-color);
        }

        .main-content {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
        }

        .section-title {
            font-size: 20px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .job-card {
            border: 1px solid #eee;
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: var(--box-shadow);
            transition: transform 0.3s;
        }

        .job-card:hover {
            transform: translateY(-3px);
        }

        .job-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--primary-color);
        }

        .job-company {
            font-weight: 500;
            color: var(--dark-color);
            margin-bottom: 5px;
        }

        .job-location, .job-deadline {
            font-size: 14px;
            color: #777;
            margin-bottom: 5px;
        }

        .job-salary {
            font-weight: bold;
            color: var(--success-color);
            margin-bottom: 10px;
        }

        .job-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .badge-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .badge-success {
            background-color: var(--success-color);
            color: white;
        }

        .badge-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .badge-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .online-users {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 15px;
            box-shadow: var(--box-shadow);
            margin-bottom: 20px;
        }

        .user-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .user-item:last-child {
            border-bottom: none;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: 500;
        }

        .user-profession {
            font-size: 12px;
            color: #777;
        }

        .user-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--success-color);
        }

        .chat-container {
            display: flex;
            flex-direction: column;
            height: 500px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .chat-header {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 15px;
            font-weight: bold;
        }

        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background-color: #f9f9f9;
        }

        .message {
            margin-bottom: 15px;
            max-width: 70%;
        }

        .message-sent {
            margin-left: auto;
            text-align: right;
        }

        .message-received {
            margin-right: auto;
        }

        .message-content {
            padding: 10px 15px;
            border-radius: 20px;
            display: inline-block;
        }

        .sent .message-content {
            background-color: var(--primary-color);
            color: white;
        }

        .received .message-content {
            background-color: white;
            border: 1px solid #ddd;
        }

        .message-time {
            font-size: 12px;
            color: #777;
            margin-top: 5px;
        }

        .chat-input {
            display: flex;
            padding: 10px;
            background-color: white;
            border-top: 1px solid #ddd;
        }

        .chat-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            margin-right: 10px;
        }

        .tab-container {
            margin-bottom: 20px;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }

        .tab.active {
            border-bottom: 2px solid var(--primary-color);
            color: var(--primary-color);
            font-weight: bold;
        }

        .tab-content {
            display: none;
            padding: 15px 0;
        }

        .tab-content.active {
            display: block;
        }

        .application-card {
            border: 1px solid #eee;
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: var(--box-shadow);
        }

        .application-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .application-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
        }

        .application-details {
            flex: 1;
        }

        .application-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .application-status {
            font-size: 14px;
        }

        .status-pending {
            color: var(--warning-color);
        }

        .status-accepted {
            color: var(--success-color);
        }

        .status-rejected {
            color: var(--danger-color);
        }

        .interview-room {
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 20px;
        }

        .video-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .video-box {
            background-color: #f0f0f0;
            border-radius: var(--border-radius);
            height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .video-box video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: var(--border-radius);
        }

        .video-label {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 3px 8px;
            border-radius: var(--border-radius);
            font-size: 12px;
        }

        .interview-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .control-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            background-color: var(--light-color);
            border: none;
            font-size: 20px;
        }

        .control-btn.end-call {
            background-color: var(--danger-color);
            color: white;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--dark-color);
            color: white;
            padding: 15px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            z-index: 1000;
            display: flex;
            align-items: center;
            transform: translateX(150%);
            transition: transform 0.3s;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-success {
            background-color: var(--success-color);
        }

        .toast-error {
            background-color: var(--danger-color);
        }

        .toast-warning {
            background-color: var(--warning-color);
        }

        .toast-info {
            background-color: var(--info-color);
        }

        .toast-close {
            margin-left: 15px;
            cursor: pointer;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }

            .nav-links {
                display: none;
            }

            .job-actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                margin-bottom: 5px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo">Skysoft Job Market</div>
            <div class="nav-links">
                <a href="#" class="active">Home</a>
                <a href="#" id="jobs-link">Jobs</a>
                <a href="#" id="post-job-link">Post Job</a>
                <a href="#" id="messages-link">Messages</a>
                <a href="#" id="profile-link">Profile</a>
            </div>
            <div class="auth-buttons">
                <button id="login-btn" class="btn btn-secondary">Login</button>
                <button id="signup-btn" class="btn btn-primary">Sign Up</button>
            </div>
        </div>
    </header>

    <div class="container">
        <div id="login-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">Login</div>
                    <button class="close-btn">&times;</button>
                </div>
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-username" class="form-label">Username or Phone Number</label>
                        <input type="text" id="login-username" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password" class="form-label">Password</label>
                        <input type="password" id="login-password" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary btn-block">Login</button>
                    </div>
                    <div class="text-center mt-3">
                        <a href="#" id="forgot-password-link">Forgot Password?</a>
                    </div>
                </form>
            </div>
        </div>

        <div id="signup-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">Create Account</div>
                    <button class="close-btn">&times;</button>
                </div>
                <form id="signup-form">
                    <div class="form-group">
                        <label for="signup-fullname" class="form-label">Full Name</label>
                        <input type="text" id="signup-fullname" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-username" class="form-label">Username (Unique)</label>
                        <input type="text" id="signup-username" class="form-control" required>
                        <small id="username-availability"></small>
                    </div>
                    <div class="form-group">
                        <label for="signup-email" class="form-label">Email</label>
                        <input type="email" id="signup-email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-phone" class="form-label">Phone Number</label>
                        <input type="tel" id="signup-phone" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-password" class="form-label">Password</label>
                        <input type="password" id="signup-password" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-confirm-password" class="form-label">Confirm Password</label>
                        <input type="password" id="signup-confirm-password" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-profession" class="form-label">Profession</label>
                        <input type="text" id="signup-profession" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-job-title" class="form-label">Job Title</label>
                        <input type="text" id="signup-job-title" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-company" class="form-label">Company (if any)</label>
                        <input type="text" id="signup-company" class="form-control">
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary btn-block">Create Account</button>
                    </div>
                    <div class="text-center mt-3">
                        Already have an account? <a href="#" id="login-from-signup-link">Login</a>
                    </div>
                </form>
            </div>
        </div>

        <div id="forgot-password-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">Reset Password</div>
                    <button class="close-btn">&times;</button>
                </div>
                <form id="forgot-password-form">
                    <div class="form-group">
                        <label for="reset-email" class="form-label">Email or Phone Number</label>
                        <input type="text" id="reset-email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary btn-block">Send Reset Code</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="verify-email-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">Verify Email</div>
                    <button class="close-btn">&times;</button>
                </div>
                <form id="verify-email-form">
                    <div class="form-group">
                        <label class="form-label">Verification code has been sent to <span id="email-to-verify"></span></label>
                        <input type="text" id="verification-code" class="form-control" placeholder="Enter verification code" required>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary btn-block">Verify</button>
                    </div>
                    <div class="text-center mt-3">
                        Didn't receive code? <a href="#" id="resend-code-link">Resend</a>
                    </div>
                </form>
            </div>
        </div>

        <div id="post-job-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">Post a Job</div>
                    <button class="close-btn">&times;</button>
                </div>
                <form id="post-job-form">
                    <div class="form-group">
                        <label for="job-title" class="form-label">Job Title</label>
                        <input type="text" id="job-title" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="job-positions" class="form-label">Number of Positions</label>
                        <input type="number" id="job-positions" class="form-control" required min="1">
                    </div>
                    <div class="form-group">
                        <label for="job-company" class="form-label">Employer/Company</label>
                        <input type="text" id="job-company" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="job-category" class="form-label">Category</label>
                        <select id="job-category" class="form-control" required>
                            <option value="">Select Category</option>
                            <!-- Categories will be loaded dynamically -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="job-location" class="form-label">Location</label>
                        <input type="text" id="job-location" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="job-deadline" class="form-label">Deadline</label>
                        <input type="date" id="job-deadline" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="job-salary" class="form-label">Salary Range (Leave blank if not disclosed)</label>
                        <div class="d-flex">
                            <input type="number" id="job-salary-min" class="form-control" placeholder="Min">
                            <span style="padding: 0 10px; display: flex; align-items: center;">to</span>
                            <input type="number" id="job-salary-max" class="form-control" placeholder="Max">
                            <select id="job-salary-currency" class="form-control" style="margin-left: 10px;">
                                <!-- Currencies will be loaded dynamically -->
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="job-description" class="form-label">Job Description</label>
                        <textarea id="job-description" class="form-control" rows="5" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="job-image" class="form-label">Job Image (Optional)</label>
                        <input type="file" id="job-image" class="form-control" accept="image/*">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Options</label>
                        <div>
                            <input type="checkbox" id="allow-comments" checked>
                            <label for="allow-comments">Allow Comments/Reactions</label>
                        </div>
                        <div>
                            <input type="checkbox" id="allow-private-messages" checked>
                            <label for="allow-private-messages">Allow Private Messages</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary btn-block">Post Job</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="apply-job-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">Apply for Job</div>
                    <button class="close-btn">&times;</button>
                </div>
                <form id="apply-job-form">
                    <div class="form-group">
                        <label for="applicant-name" class="form-label">Full Name</label>
                        <input type="text" id="applicant-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="applicant-email" class="form-label">Email</label>
                        <input type="email" id="applicant-email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="applicant-phone" class="form-label">Phone Number</label>
                        <input type="tel" id="applicant-phone" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="applicant-age" class="form-label">Age</label>
                        <input type="number" id="applicant-age" class="form-control" required min="18">
                    </div>
                    <div class="form-group">
                        <label for="applicant-gender" class="form-label">Gender</label>
                        <select id="applicant-gender" class="form-control" required>
                            <option value="">Select Gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="applicant-location" class="form-label">Current Location</label>
                        <input type="text" id="applicant-location" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="applicant-experience" class="form-label">Years of Experience</label>
                        <input type="number" id="applicant-experience" class="form-control" required min="0">
                    </div>
                    <div class="form-group">
                        <label for="applicant-qualifications" class="form-label">Qualifications</label>
                        <textarea id="applicant-qualifications" class="form-control" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="applicant-photo" class="form-label">Portrait Photo</label>
                        <input type="file" id="applicant-photo" class="form-control" accept="image/*" required>
                    </div>
                    <div class="form-group">
                        <label for="applicant-cv" class="form-label">Upload CV</label>
                        <input type="file" id="applicant-cv" class="form-control" accept=".pdf,.doc,.docx" required>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary btn-block">Submit Application</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="report-job-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title">Report Job</div>
                    <button class="close-btn">&times;</button>
                </div>
                <form id="report-job-form">
                    <div class="form-group">
                        <label for="report-reason" class="form-label">Reason for Reporting</label>
                        <select id="report-reason" class="form-control" required>
                            <option value="">Select Reason</option>
                            <option value="fraud">Fraud/Scam</option>
                            <option value="spam">Spam</option>
                            <option value="inappropriate">Inappropriate Content</option>
                            <option value="misleading">Misleading Information</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="report-details" class="form-label">Details</label>
                        <textarea id="report-details" class="form-control" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="report-screenshot" class="form-label">Screenshots (Optional but recommended)</label>
                        <input type="file" id="report-screenshot" class="form-control" accept="image/*" multiple>
                    </div>
                    <div class="form-group">
                        <label for="report-audio" class="form-label">Audio Evidence (Optional)</label>
                        <input type="file" id="report-audio" class="form-control" accept="audio/*">
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-danger btn-block">Submit Report</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="chat-modal" class="modal">
            <div class="modal-content" style="max-width: 800px;">
                <div class="modal-header">
                    <div class="modal-title" id="chat-title">Chat</div>
                    <button class="close-btn">&times;</button>
                </div>
                <div class="chat-container">
                    <div class="chat-header" id="chat-header">Select a user to chat with</div>
                    <div class="chat-messages" id="chat-messages"></div>
                    <div class="chat-input" id="chat-input-area" style="display: none;">
                        <input type="text" id="chat-message-input" placeholder="Type your message...">
                        <button id="send-message-btn" class="btn btn-primary">Send</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="admin-modal" class="modal">
            <div class="modal-content" style="max-width: 800px;">
                <div class="modal-header">
                    <div class="modal-title">Admin Panel</div>
                    <button class="close-btn">&times;</button>
                </div>
                <div class="tab-container">
                    <div class="tabs">
                        <div class="tab active" data-tab="reports">Reports</div>
                        <div class="tab" data-tab="users">Users</div>
                        <div class="tab" data-tab="jobs">Jobs</div>
                        <div class="tab" data-tab="settings">Settings</div>
                        <div class="tab" data-tab="backup">Backup</div>
                    </div>
                    <div class="tab-content active" id="reports-tab">
                        <div id="reports-list">
                            <!-- Reports will be loaded here -->
                        </div>
                    </div>
                    <div class="tab-content" id="users-tab">
                        <div class="form-group">
                            <input type="text" id="search-users" class="form-control" placeholder="Search users...">
                        </div>
                        <div id="users-list">
                            <!-- Users will be loaded here -->
                        </div>
                    </div>
                    <div class="tab-content" id="jobs-tab">
                        <div class="form-group">
                            <input type="text" id="search-jobs-admin" class="form-control" placeholder="Search jobs...">
                        </div>
                        <div id="jobs-list-admin">
                            <!-- Jobs will be loaded here -->
                        </div>
                    </div>
                    <div class="tab-content" id="settings-tab">
                        <form id="admin-settings-form">
                            <div class="form-group">
                                <label for="app-name" class="form-label">Application Name</label>
                                <input type="text" id="app-name" class="form-control" value="Skysoft Job Market">
                            </div>
                            <div class="form-group">
                                <label for="admin-email" class="form-label">Admin Email</label>
                                <input type="email" id="admin-email" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="system-email" class="form-label">System Email (for sending notifications)</label>
                                <input type="email" id="system-email" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="blue-tick-threshold" class="form-label">Blue Tick Threshold (number of posts)</label>
                                <input type="number" id="blue-tick-threshold" class="form-control" value="100" min="1">
                            </div>
                            <div class="form-group">
                                <label for="ban-duration" class="form-label">Ban Duration (months)</label>
                                <input type="number" id="ban-duration" class="form-control" value="12" min="1">
                            </div>
                            <div class="form-group">
                                <label for="code-tamper-ban" class="form-label">Code Tampering Ban Duration (months)</label>
                                <input type="number" id="code-tamper-ban" class="form-control" value="1" min="1">
                            </div>
                            <div class="form-group">
                                <label for="admin-inactivity" class="form-label">Admin Inactivity Period (months)</label>
                                <input type="number" id="admin-inactivity" class="form-control" value="6" min="1">
                            </div>
                            <div class="form-group">
                                <label for="successor-email" class="form-label">Successor Email (for admin inheritance)</label>
                                <input type="email" id="successor-email" class="form-control">
                            </div>
                            <div class="form-group">
                                <label for="successor-phone" class="form-label">Successor Phone (for admin inheritance)</label>
                                <input type="tel" id="successor-phone" class="form-control">
                            </div>
                            <div class="form-group">
                                <button type="submit" class="btn btn-primary">Save Settings</button>
                            </div>
                        </form>
                    </div>
                    <div class="tab-content" id="backup-tab">
                        <div class="form-group">
                            <label class="form-label">Database Backup</label>
                            <button id="export-db-btn" class="btn btn-primary">Export Database</button>
                            <button id="import-db-btn" class="btn btn-secondary">Import Database</button>
                            <input type="file" id="import-db-file" style="display: none;" accept=".json">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Network Status</label>
                            <div id="network-status">Connecting to peers...</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">System Messages</label>
                            <textarea id="system-message" class="form-control" rows="3" placeholder="Enter message to broadcast to all users"></textarea>
                            <button id="send-system-message" class="btn btn-primary mt-2">Broadcast Message</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="interview-modal" class="modal">
            <div class="modal-content" style="max-width: 800px;">
                <div class="modal-header">
                    <div class="modal-title">Interview Room</div>
                    <button class="close-btn">&times;</button>
                </div>
                <div class="interview-room">
                    <div class="video-container">
                        <div class="video-box">
                            <div id="local-video"></div>
                            <div class="video-label">You</div>
                        </div>
                        <div class="video-box">
                            <div id="remote-video"></div>
                            <div class="video-label" id="remote-user-label">Interviewer</div>
                        </div>
                    </div>
                    <div class="interview-controls">
                        <button class="control-btn" id="mute-audio-btn" title="Mute">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <button class="control-btn" id="mute-video-btn" title="Stop Video">
                            <i class="fas fa-video"></i>
                        </button>
                        <button class="control-btn end-call" id="end-call-btn" title="End Call">
                            <i class="fas fa-phone-slash"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="dashboard" style="display: none;">
            <div class="dashboard">
                <div class="sidebar">
                    <div class="user-profile">
                        <img id="sidebar-avatar" src="" alt="Profile" class="user-avatar">
                        <div id="sidebar-username">Username</div>
                        <div id="sidebar-profession">Profession</div>
                    </div>
                    <ul class="sidebar-menu">
                        <li><a href="#" class="active" id="dashboard-link"><i class="fas fa-home"></i> Dashboard</a></li>
                        <li><a href="#" id="my-jobs-link"><i class="fas fa-briefcase"></i> My Jobs</a></li>
                        <li><a href="#" id="my-applications-link"><i class="fas fa-file-alt"></i> My Applications</a></li>
                        <li><a href="#" id="messages-sidebar-link"><i class="fas fa-envelope"></i> Messages</a></li>
                        <li><a href="#" id="notifications-link"><i class="fas fa-bell"></i> Notifications</a></li>
                        <li><a href="#" id="profile-sidebar-link"><i class="fas fa-user"></i> Profile</a></li>
                        <li><a href="#" id="settings-link"><i class="fas fa-cog"></i> Settings</a></li>
                        <li id="admin-menu-item" style="display: none;"><a href="#" id="admin-link"><i class="fas fa-shield-alt"></i> Admin</a></li>
                        <li><a href="#" id="logout-link"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                    </ul>
                    <div class="online-users">
                        <h4>Online Users</h4>
                        <div id="online-users-list">
                            <!-- Online users will be loaded here -->
                        </div>
                    </div>
                </div>
                <div class="main-content">
                    <h2 class="section-title" id="content-title">Recent Jobs</h2>
                    <div class="form-group">
                        <input type="text" id="job-search" class="form-control" placeholder="Search jobs...">
                    </div>
                    <div class="form-group">
                        <select id="job-category-filter" class="form-control">
                            <option value="">All Categories</option>
                            <!-- Categories will be loaded dynamically -->
                        </select>
                    </div>
                    <div class="form-group">
                        <select id="job-location-filter" class="form-control">
                            <option value="">All Locations</option>
                            <!-- Locations will be loaded dynamically -->
                        </select>
                    </div>
                    <div id="jobs-list">
                        <!-- Jobs will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <div id="welcome-message" style="text-align: center; margin-top: 50px;">
            <h1>Welcome to Skysoft Job Market</h1>
            <p>Find your dream job or the perfect candidate in our decentralized peer-to-peer network</p>
            <button id="get-started-btn" class="btn btn-primary" style="margin-top: 20px;">Get Started</button>
        </div>
    </div>

    <div id="toast" class="toast">
        <span id="toast-message"></span>
        <span class="toast-close">&times;</span>
    </div>

    <script>
        // Global variables
        let db;
        let ipfs;
        let node;
        let peerId;
        let currentUser = null;
        let isAdmin = false;
        let peers = {};
        let chatPartner = null;
        let currentJob = null;
        let currentInterview = null;
        let localStream = null;
        let peerConnection = null;
        let dataChannel = null;
        let currencyRates = {};
        let defaultCurrency = 'UGX';
        let countries = {
            'UG': {name: 'Uganda', currency: 'UGX', symbol: 'USh'},
            'KE': {name: 'Kenya', currency: 'KES', symbol: 'KSh'},
            'TZ': {name: 'Tanzania', currency: 'TZS', symbol: 'TSh'},
            'RW': {name: 'Rwanda', currency: 'RWF', symbol: 'RF'},
            // Add more countries as needed
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', async function() {
            // Initialize IndexedDB
            await initDB();
            
            // Check if user is logged in
            await checkAuth();
            
            // Initialize IPFS and P2P network
            await initNetwork();
            
            // Setup event listeners
            setupEventListeners();
            
            // Load initial data
            loadInitialData();
            
            // Detect user's location
            detectLocation();
            
            // Load currency rates
            loadCurrencyRates();
        });

        // Initialize IndexedDB
        async function initDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('SkysoftJobMarketDB', 1);
                
                request.onupgradeneeded = function(event) {
                    const db = event.target.result;
                    
                    // Create users store
                    if (!db.objectStoreNames.contains('users')) {
                        const usersStore = db.createObjectStore('users', { keyPath: 'id' });
                        usersStore.createIndex('username', 'username', { unique: true });
                        usersStore.createIndex('email', 'email', { unique: true });
                        usersStore.createIndex('phone', 'phone', { unique: true });
                    }
                    
                    // Create jobs store
                    if (!db.objectStoreNames.contains('jobs')) {
                        const jobsStore = db.createObjectStore('jobs', { keyPath: 'id' });
                        jobsStore.createIndex('posterId', 'posterId');
                        jobsStore.createIndex('deadline', 'deadline');
                        jobsStore.createIndex('location', 'location');
                        jobsStore.createIndex('category', 'category');
                    }
                    
                    // Create applications store
                    if (!db.objectStoreNames.contains('applications')) {
                        const appsStore = db.createObjectStore('applications', { keyPath: 'id' });
                        appsStore.createIndex('jobId', 'jobId');
                        appsStore.createIndex('applicantId', 'applicantId');
                    }
                    
                    // Create messages store
                    if (!db.objectStoreNames.contains('messages')) {
                        const messagesStore = db.createObjectStore('messages', { keyPath: 'id' });
                        messagesStore.createIndex('senderId', 'senderId');
                        messagesStore.createIndex('receiverId', 'receiverId');
                    }
                    
                    // Create reports store
                    if (!db.objectStoreNames.contains('reports')) {
                        const reportsStore = db.createObjectStore('reports', { keyPath: 'id' });
                        reportsStore.createIndex('jobId', 'jobId');
                        reportsStore.createIndex('reporterId', 'reporterId');
                    }
                    
                    // Create settings store
                    if (!db.objectStoreNames.contains('settings')) {
                        db.createObjectStore('settings', { keyPath: 'id' });
                    }
                    
                    // Create activity store
                    if (!db.objectStoreNames.contains('activity')) {
                        const activityStore = db.createObjectStore('activity', { keyPath: 'id' });
                        activityStore.createIndex('userId', 'userId');
                    }
                    
                    // Create companies store
                    if (!db.objectStoreNames.contains('companies')) {
                        const companiesStore = db.createObjectStore('companies', { keyPath: 'id' });
                        companiesStore.createIndex('ownerId', 'ownerId');
                        companiesStore.createIndex('name', 'name', { unique: true });
                    }
                    
                    // Create categories store
                    if (!db.objectStoreNames.contains('categories')) {
                        db.createObjectStore('categories', { keyPath: 'id' });
                    }
                    
                    // Create bans store
                    if (!db.objectStoreNames.contains('bans')) {
                        const bansStore = db.createObjectStore('bans', { keyPath: 'id' });
                        bansStore.createIndex('userId', 'userId');
                        bansStore.createIndex('ip', 'ip');
                        bansStore.createIndex('deviceId', 'deviceId');
                    }
                };
                
                request.onsuccess = function(event) {
                    db = event.target.result;
                    resolve(db);
                };
                
                request.onerror = function(event) {
                    console.error('IndexedDB error:', event.target.error);
                    reject(event.target.error);
                };
            });
        }

        // Check authentication status
        async function checkAuth() {
            const user = await getFromDB('currentUser');
            if (user) {
                currentUser = user;
                isAdmin = user.isAdmin || false;
                showDashboard();
                updateUserOnlineStatus(true);
            } else {
                showWelcome();
            }
        }

        // Initialize P2P network
        async function initNetwork() {
            try {
                // Initialize IPFS
                ipfs = await Ipfs.create({
                    repo: 'skysoft-job-market',
                    config: {
                        Addresses: {
                            Swarm: [
                                '/dns4/wrtc-star1.par.dwebops.pub/tcp/443/wss/p2p-webrtc-star',
                                '/dns4/wrtc-star2.sjc.dwebops.pub/tcp/443/wss/p2p-webrtc-star'
                            ]
                        },
                        Bootstrap: [
                            '/dns4/bootstrap.libp2p.io/tcp/443/wss/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN',
                            '/dns4/ipfs.io/tcp/443/wss/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb'
                        ]
                    }
                });

                // Get peer ID
                const id = await ipfs.id();
                peerId = id.id;

                // Listen for peers
                ipfs.pubsub.subscribe('skysoft-job-market', handleMessage);
                ipfs.swarm.on('peer', handlePeer);

                console.log('IPFS node initialized with ID:', peerId);

                // Initialize DAT
                const sdk = await DatSdk.create({
                    persist: true,
                    storage: randomAccessMemory()
                });

                // Join the DAT network
                const dat = await sdk.get('skysoft-job-market');
                await dat.ready();

                // Sync data
                dat.on('update', async () => {
                    const data = await dat.readFile('/data.json');
                    if (data) {
                        const parsed = JSON.parse(data);
                        syncData(parsed);
                    }
                });

                // Broadcast presence
                broadcastPresence();
                setInterval(broadcastPresence, 30000); // Every 30 seconds

            } catch (error) {
                console.error('Error initializing network:', error);
                showToast('Failed to connect to network. Trying again...', 'error');
                setTimeout(initNetwork, 5000);
            }
        }

        // Handle incoming messages
        function handleMessage(msg) {
            try {
                const data = JSON.parse(new TextDecoder().decode(msg.data));
                
                // Update peer info
                if (data.type === 'presence' && data.peerId !== peerId) {
                    peers[data.peerId] = {
                        ...data.user,
                        lastSeen: Date.now()
                    };
                    updateOnlineUsersList();
                }
                
                // Handle different message types
                switch(data.type) {
                    case 'job':
                        addOrUpdateJob(data.job);
                        break;
                    case 'application':
                        addOrUpdateApplication(data.application);
                        break;
                    case 'message':
                        addMessage(data.message);
                        break;
                    case 'report':
                        addOrUpdateReport(data.report);
                        break;
                    case 'user':
                        updateUser(data.user);
                        break;
                    case 'system':
                        if (currentUser) {
                            showToast(data.message, 'info');
                        }
                        break;
                    case 'sync-request':
                        if (data.peerId !== peerId) {
                            sendSyncData(data.peerId);
                        }
                        break;
                }
            } catch (error) {
                console.error('Error handling message:', error);
            }
        }

        // Handle peer connections
        function handlePeer(peerId) {
            console.log('Connected to peer:', peerId);
            peers[peerId] = peers[peerId] || { peerId, lastSeen: Date.now() };
            updateOnlineUsersList();
            
            // Request sync data from peer
            sendMessage({
                type: 'sync-request',
                peerId: peerId
            });
        }

        // Broadcast presence to network
        function broadcastPresence() {
            if (currentUser) {
                sendMessage({
                    type: 'presence',
                    peerId: peerId,
                    user: {
                        id: currentUser.id,
                        username: currentUser.username,
                        name: currentUser.name,
                        profession: currentUser.profession,
                        online: true
                    }
                });
            }
        }

        // Send message to network
        function sendMessage(data) {
            try {
                ipfs.pubsub.publish('skysoft-job-market', new TextEncoder().encode(JSON.stringify(data)));
            } catch (error) {
                console.error('Error sending message:', error);
            }
        }

        // Sync data with peer
        async function sendSyncData(targetPeerId) {
            const jobs = await getAllFromDB('jobs');
            const users = await getAllFromDB('users');
            const applications = await getAllFromDB('applications');
            const messages = await getAllFromDB('messages');
            const reports = await getAllFromDB('reports');
            
            sendMessage({
                type: 'sync',
                peerId: peerId,
                data: {
                    jobs,
                    users,
                    applications,
                    messages,
                    reports
                }
            }, targetPeerId);
        }

        // Sync data from peer
        function syncData(data) {
            if (data.jobs) {
                data.jobs.forEach(job => addOrUpdateJob(job));
            }
            if (data.users) {
                data.users.forEach(user => updateUser(user));
            }
            if (data.applications) {
                data.applications.forEach(app => addOrUpdateApplication(app));
            }
            if (data.messages) {
                data.messages.forEach(msg => addMessage(msg));
            }
            if (data.reports) {
                data.reports.forEach(report => addOrUpdateReport(report));
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Auth buttons
            document.getElementById('login-btn').addEventListener('click', () => showModal('login-modal'));
            document.getElementById('signup-btn').addEventListener('click', () => showModal('signup-modal'));
            document.getElementById('get-started-btn').addEventListener('click', () => showModal('signup-modal'));
            document.getElementById('forgot-password-link').addEventListener('click', () => {
                hideModal('login-modal');
                showModal('forgot-password-modal');
            });
            document.getElementById('login-from-signup-link').addEventListener('click', () => {
                hideModal('signup-modal');
                showModal('login-modal');
            });
            
            // Forms
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            document.getElementById('signup-form').addEventListener('submit', handleSignup);
            document.getElementById('forgot-password-form').addEventListener('submit', handleForgotPassword);
            document.getElementById('verify-email-form').addEventListener('submit', handleVerifyEmail);
            document.getElementById('post-job-form').addEventListener('submit', handlePostJob);
            document.getElementById('apply-job-form').addEventListener('submit', handleApplyJob);
            document.getElementById('report-job-form').addEventListener('submit', handleReportJob);
            document.getElementById('admin-settings-form').addEventListener('submit', handleAdminSettings);
            
            // Username availability check
            document.getElementById('signup-username').addEventListener('blur', checkUsernameAvailability);
            
            // Modal close buttons
            document.querySelectorAll('.close-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    hideModal(modal.id);
                });
            });
            
            // Dashboard links
            document.getElementById('dashboard-link').addEventListener('click', (e) => {
                e.preventDefault();
                loadDashboard();
            });
            document.getElementById('my-jobs-link').addEventListener('click', (e) => {
                e.preventDefault();
                loadMyJobs();
            });
            document.getElementById('my-applications-link').addEventListener('click', (e) => {
                e.preventDefault();
                loadMyApplications();
            });
            document.getElementById('messages-sidebar-link').addEventListener('click', (e) => {
                e.preventDefault();
                loadMessages();
            });
            document.getElementById('profile-sidebar-link').addEventListener('click', (e) => {
                e.preventDefault();
                loadProfile();
            });
            document.getElementById('settings-link').addEventListener('click', (e) => {
                e.preventDefault();
                loadSettings();
            });
            document.getElementById('admin-link').addEventListener('click', (e) => {
                e.preventDefault();
                showModal('admin-modal');
                loadAdminReports();
            });
            document.getElementById('logout-link').addEventListener('click', (e) => {
                e.preventDefault();
                handleLogout();
            });
            
            // Nav links
            document.getElementById('jobs-link').addEventListener('click', (e) => {
                e.preventDefault();
                loadDashboard();
            });
            document.getElementById('post-job-link').addEventListener('click', (e) => {
                e.preventDefault();
                if (currentUser) {
                    showModal('post-job-modal');
                } else {
                    showModal('login-modal');
                }
            });
            document.getElementById('messages-link').addEventListener('click', (e) => {
                e.preventDefault();
                if (currentUser) {
                    loadMessages();
                } else {
                    showModal('login-modal');
                }
            });
            document.getElementById('profile-link').addEventListener('click', (e) => {
                e.preventDefault();
                if (currentUser) {
                    loadProfile();
                } else {
                    showModal('login-modal');
                }
            });
            
            // Search and filters
            document.getElementById('job-search').addEventListener('input', filterJobs);
            document.getElementById('job-category-filter').addEventListener('change', filterJobs);
            document.getElementById('job-location-filter').addEventListener('change', filterJobs);
            
            // Admin tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    switchAdminTab(tabId);
                });
            });
            
            // Admin actions
            document.getElementById('export-db-btn').addEventListener('click', exportDatabase);
            document.getElementById('import-db-btn').addEventListener('click', () => document.getElementById('import-db-file').click());
            document.getElementById('import-db-file').addEventListener('change', importDatabase);
            document.getElementById('send-system-message').addEventListener('click', sendSystemMessage);
            
            // Chat
            document.getElementById('send-message-btn').addEventListener('click', sendChatMessage);
            document.getElementById('chat-message-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendChatMessage();
                }
            });
            
            // Toast close
            document.querySelector('.toast-close').addEventListener('click', hideToast);
            
            // Interview controls
            document.getElementById('mute-audio-btn').addEventListener('click', toggleAudio);
            document.getElementById('mute-video-btn').addEventListener('click', toggleVideo);
            document.getElementById('end-call-btn').addEventListener('click', endCall);
        }

        // Show modal
        function showModal(id) {
            document.getElementById(id).style.display = 'flex';
        }

        // Hide modal
        function hideModal(id) {
            document.getElementById(id).style.display = 'none';
        }

        // Show toast message
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            
            toastMessage.textContent = message;
            toast.className = 'toast';
            toast.classList.add(`toast-${type}`);
            toast.classList.add('show');
            
            setTimeout(hideToast, 5000);
        }

        // Hide toast
        function hideToast() {
            document.getElementById('toast').classList.remove('show');
        }

        // Show welcome screen
        function showWelcome() {
            document.getElementById('welcome-message').style.display = 'block';
            document.getElementById('dashboard').style.display = 'none';
        }

        // Show dashboard
        function showDashboard() {
            document.getElementById('welcome-message').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            
            // Update sidebar
            if (currentUser) {
                document.getElementById('sidebar-username').textContent = currentUser.username || currentUser.name;
                document.getElementById('sidebar-profession').textContent = currentUser.profession || '';
                if (currentUser.avatar) {
                    document.getElementById('sidebar-avatar').src = currentUser.avatar;
                }
                
                if (isAdmin) {
                    document.getElementById('admin-menu-item').style.display = 'block';
                } else {
                    document.getElementById('admin-menu-item').style.display = 'none';
                }
            }
            
            loadDashboard();
        }

        // Load dashboard content
        async function loadDashboard() {
            document.getElementById('content-title').textContent = 'Recent Jobs';
            
            const jobs = await getAllFromDB('jobs');
            const currentDate = new Date().toISOString();
            
            // Filter out expired jobs
            const activeJobs = jobs.filter(job => job.deadline >= currentDate);
            
            displayJobs(activeJobs);
            
            // Load categories and locations for filters
            loadJobFilters();
        }

        // Load my jobs
        async function loadMyJobs() {
            if (!currentUser) return;
            
            document.getElementById('content-title').textContent = 'My Job Posts';
            
            const jobs = await getAllFromDB('jobs');
            const myJobs = jobs.filter(job => job.posterId === currentUser.id);
            
            displayJobs(myJobs);
        }

        // Load my applications
        async function loadMyApplications() {
            if (!currentUser) return;
            
            document.getElementById('content-title').textContent = 'My Applications';
            
            const applications = await getAllFromDB('applications');
            const jobs = await getAllFromDB('jobs');
            
            const myApplications = applications.filter(app => app.applicantId === currentUser.id);
            
            displayApplications(myApplications, jobs);
        }

        // Load messages
        async function loadMessages() {
            if (!currentUser) return;
            
            document.getElementById('content-title').textContent = 'Messages';
            
            // TODO: Implement messages list
            document.getElementById('jobs-list').innerHTML = '<p>Messages feature coming soon</p>';
        }

        // Load profile
        async function loadProfile() {
            if (!currentUser) return;
            
            document.getElementById('content-title').textContent = 'My Profile';
            
            // TODO: Implement profile view/edit
            document.getElementById('jobs-list').innerHTML = '<p>Profile feature coming soon</p>';
        }

        // Load settings
        async function loadSettings() {
            if (!currentUser) return;
            
            document.getElementById('content-title').textContent = 'Settings';
            
            // TODO: Implement settings
            document.getElementById('jobs-list').innerHTML = '<p>Settings feature coming soon</p>';
        }

        // Load job filters
        async function loadJobFilters() {
            const jobs = await getAllFromDB('jobs');
            const categories = await getAllFromDB('categories');
            
            // Categories
            const categoryFilter = document.getElementById('job-category-filter');
            categoryFilter.innerHTML = '<option value="">All Categories</option>';
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = category.name;
                categoryFilter.appendChild(option);
            });
            
            // Locations
            const locationFilter = document.getElementById('job-location-filter');
            locationFilter.innerHTML = '<option value="">All Locations</option>';
            
            const locations = [...new Set(jobs.map(job => job.location))];
            locations.forEach(location => {
                const option = document.createElement('option');
                option.value = location;
                option.textContent = location;
                locationFilter.appendChild(option);
            });
        }

        // Filter jobs
        async function filterJobs() {
            const searchTerm = document.getElementById('job-search').value.toLowerCase();
            const categoryFilter = document.getElementById('job-category-filter').value;
            const locationFilter = document.getElementById('job-location-filter').value;
            
            const jobs = await getAllFromDB('jobs');
            const currentDate = new Date().toISOString();
            
            let filteredJobs = jobs.filter(job => job.deadline >= currentDate);
            
            if (searchTerm) {
                filteredJobs = filteredJobs.filter(job => 
                    job.title.toLowerCase().includes(searchTerm) || 
                    job.company.toLowerCase().includes(searchTerm) ||
                    job.description.toLowerCase().includes(searchTerm)
                );
            }
            
            if (categoryFilter) {
                filteredJobs = filteredJobs.filter(job => job.category === categoryFilter);
            }
            
            if (locationFilter) {
                filteredJobs = filteredJobs.filter(job => job.location === locationFilter);
            }
            
            displayJobs(filteredJobs);
        }

        // Display jobs
        function displayJobs(jobs) {
            const jobsList = document.getElementById('jobs-list');
            
            if (jobs.length === 0) {
                jobsList.innerHTML = '<p>No jobs found</p>';
                return;
            }
            
            jobsList.innerHTML = '';
            
            // Sort by deadline (soonest first)
            jobs.sort((a, b) => new Date(a.deadline) - new Date(b.deadline));
            
            jobs.forEach(job => {
                const jobCard = document.createElement('div');
                jobCard.className = 'job-card';
                
                const salaryText = job.salaryMin ? 
                    `${formatCurrency(job.salaryMin, job.currency)} - ${formatCurrency(job.salaryMax, job.currency)}` : 
                    'Not disclosed';
                
                const deadline = new Date(job.deadline).toLocaleDateString();
                
                jobCard.innerHTML = `
                    <h3 class="job-title">${job.title}</h3>
                    <div class="job-company">${job.company} ${job.blueTick ? '<span class="badge badge-primary"></span>' : ''}</div>
                    <div class="job-location"><i class="fas fa-map-marker-alt"></i> ${job.location}</div>
                    <div class="job-deadline"><i class="fas fa-clock"></i> Deadline: ${deadline}</div>
                    <div class="job-salary"><i class="fas fa-money-bill-wave"></i> ${salaryText}</div>
                    <p>${job.description.substring(0, 150)}...</p>
                    <div class="job-actions">
                        <button class="btn btn-primary apply-btn" data-job-id="${job.id}">Apply</button>
                        <button class="btn btn-secondary view-btn" data-job-id="${job.id}">View Details</button>
                        ${job.posterId === currentUser?.id ? `<button class="btn btn-danger delete-btn" data-job-id="${job.id}">Delete</button>` : ''}
                        ${job.posterId !== currentUser?.id ? `<button class="btn btn-warning report-btn" data-job-id="${job.id}">Report</button>` : ''}
                    </div>
                    ${job.allowComments ? '<div class="job-comments"><i class="fas fa-comments"></i> Comments enabled</div>' : ''}
                    ${job.allowPrivateMessages ? '<div class="job-messages"><i class="fas fa-envelope"></i> Private messages enabled</div>' : ''}
                    <div class="job-note" style="color: red; font-size: 12px; margin-top: 10px;">
                        <input type="checkbox" checked disabled> This job is free to apply! No one should ask for money. If asked for money report the job immediately.
                    </div>
                `;
                
                jobsList.appendChild(jobCard);
            });
            
            // Add event listeners to buttons
            document.querySelectorAll('.apply-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const jobId = this.getAttribute('data-job-id');
                    applyForJob(jobId);
                });
            });
            
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const jobId = this.getAttribute('data-job-id');
                    viewJobDetails(jobId);
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const jobId = this.getAttribute('data-job-id');
                    deleteJob(jobId);
                });
            });
            
            document.querySelectorAll('.report-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const jobId = this.getAttribute('data-job-id');
                    reportJob(jobId);
                });
            });
        }

        // Display applications
        function displayApplications(applications, jobs) {
            const jobsList = document.getElementById('jobs-list');
            
            if (applications.length === 0) {
                jobsList.innerHTML = '<p>No applications found</p>';
                return;
            }
            
            jobsList.innerHTML = '';
            
            applications.forEach(app => {
                const job = jobs.find(j => j.id === app.jobId);
                if (!job) return;
                
                const appCard = document.createElement('div');
                appCard.className = 'application-card';
                
                const statusClass = app.status === 'pending' ? 'status-pending' : 
                                    app.status === 'accepted' ? 'status-accepted' : 'status-rejected';
                
                appCard.innerHTML = `
                    <div class="application-header">
                        <img src="${app.photo || 'https://via.placeholder.com/50'}" alt="Applicant" class="application-avatar">
                        <div class="application-details">
                            <div class="application-name">${app.name}</div>
                            <div class="application-status ${statusClass}">Status: ${app.status}</div>
                        </div>
                    </div>
                    <h4>${job.title}</h4>
                    <p>${job.company}</p>
                    <p>Applied on: ${new Date(app.appliedDate).toLocaleDateString()}</p>
                    <div class="application-actions">
                        <button class="btn btn-primary view-btn" data-app-id="${app.id}">View Details</button>
                        ${app.status === 'pending' ? `<button class="btn btn-danger withdraw-btn" data-app-id="${app.id}">Withdraw</button>` : ''}
                        ${app.interviewDate ? `<div class="interview-info">Interview scheduled for ${new Date(app.interviewDate).toLocaleString()}</div>` : ''}
                    </div>
                `;
                
                jobsList.appendChild(appCard);
            });
            
            // Add event listeners to buttons
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const appId = this.getAttribute('data-app-id');
                    viewApplicationDetails(appId);
                });
            });
            
            document.querySelectorAll('.withdraw-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const appId = this.getAttribute('data-app-id');
                    withdrawApplication(appId);
                });
            });
        }

        // View job details
        async function viewJobDetails(jobId) {
            const job = await getFromDB('jobs', jobId);
            if (!job) return;
            
            // TODO: Implement detailed job view
            alert(`Job Details:\nTitle: ${job.title}\nCompany: ${job.company}\nLocation: ${job.location}\nDeadline: ${new Date(job.deadline).toLocaleDateString()}`);
        }

        // View application details
        async function viewApplicationDetails(appId) {
            const application = await getFromDB('applications', appId);
            if (!application) return;
            
            // TODO: Implement detailed application view
            alert(`Application Details:\nName: ${application.name}\nStatus: ${application.status}\nExperience: ${application.experience} years`);
        }

        // Apply for job
        function applyForJob(jobId) {
            if (!currentUser) {
                showModal('login-modal');
                return;
            }
            
            currentJob = jobId;
            showModal('apply-job-modal');
            
            // Pre-fill user details
            if (currentUser) {
                document.getElementById('applicant-name').value = currentUser.name;
                document.getElementById('applicant-email').value = currentUser.email;
                document.getElementById('applicant-phone').value = currentUser.phone;
                document.getElementById('applicant-location').value = currentUser.location || '';
            }
        }

        // Report job
        function reportJob(jobId) {
            if (!currentUser) {
                showModal('login-modal');
                return;
            }
            
            currentJob = jobId;
            showModal('report-job-modal');
        }

        // Withdraw application
        async function withdrawApplication(appId) {
            if (!confirm('Are you sure you want to withdraw this application?')) return;
            
            try {
                await deleteFromDB('applications', appId);
                showToast('Application withdrawn successfully', 'success');
                loadMyApplications();
            } catch (error) {
                console.error('Error withdrawing application:', error);
                showToast('Failed to withdraw application', 'error');
            }
        }

        // Delete job
        async function deleteJob(jobId) {
            if (!confirm('Are you sure you want to delete this job post?')) return;
            
            try {
                await deleteFromDB('jobs', jobId);
                
                // Also delete related applications
                const applications = await getAllFromDB('applications');
                const jobApplications = applications.filter(app => app.jobId === jobId);
                
                for (const app of jobApplications) {
                    await deleteFromDB('applications', app.id);
                }
                
                showToast('Job deleted successfully', 'success');
                loadMyJobs();
            } catch (error) {
                console.error('Error deleting job:', error);
                showToast('Failed to delete job', 'error');
            }
        }

        // Update online users list
        function updateOnlineUsersList() {
            const onlineUsersList = document.getElementById('online-users-list');
            onlineUsersList.innerHTML = '';
            
            const now = Date.now();
            const onlinePeers = Object.values(peers).filter(peer => peer.online && (now - peer.lastSeen) < 120000); // 2 minutes
            
            if (onlinePeers.length === 0) {
                onlineUsersList.innerHTML = '<p>No users online</p>';
                return;
            }
            
            onlinePeers.forEach(peer => {
                if (peer.id === currentUser?.id) return; // Don't show current user
                
                const userItem = document.createElement('div');
                userItem.className = 'user-item';
                
                userItem.innerHTML = `
                    <img src="https://via.placeholder.com/40" alt="User" class="user-avatar">
                    <div class="user-info">
                        <div class="user-name">${peer.name || peer.username}</div>
                        <div class="user-profession">${peer.profession || ''}</div>
                    </div>
                    <div class="user-status"></div>
                    <button class="btn btn-primary chat-user-btn" data-user-id="${peer.id}">Chat</button>
                    <button class="btn btn-secondary ask-job-btn" data-user-id="${peer.id}">Ask About Jobs</button>
                `;
                
                onlineUsersList.appendChild(userItem);
            });
            
            // Add event listeners to buttons
            document.querySelectorAll('.chat-user-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const userId = this.getAttribute('data-user-id');
                    startChat(userId);
                });
            });
            
            document.querySelectorAll('.ask-job-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const userId = this.getAttribute('data-user-id');
                    askAboutJobs(userId);
                });
            });
        }

        // Start chat with user
        function startChat(userId) {
            const peer = Object.values(peers).find(p => p.id === userId);
            if (!peer) return;
            
            chatPartner = peer;
            
            document.getElementById('chat-title').textContent = `Chat with ${peer.name || peer.username}`;
            document.getElementById('chat-header').textContent = `Chatting with ${peer.name || peer.username}`;
            document.getElementById('chat-input-area').style.display = 'flex';
            
            // Load chat history
            loadChatHistory(userId);
            
            showModal('chat-modal');
        }

        // Load chat history
        async function loadChatHistory(userId) {
            const messages = await getAllFromDB('messages');
            const chatMessages = document.getElementById('chat-messages');
            chatMessages.innerHTML = '';
            
            const filteredMessages = messages.filter(msg => 
                (msg.senderId === currentUser.id && msg.receiverId === userId) ||
                (msg.senderId === userId && msg.receiverId === currentUser.id)
            ).sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            
            if (filteredMessages.length === 0) {
                chatMessages.innerHTML = '<p>No messages yet</p>';
                return;
            }
            
            filteredMessages.forEach(msg => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${msg.senderId === currentUser.id ? 'message-sent sent' : 'message-received received'}`;
                
                messageDiv.innerHTML = `
                    <div class="message-content">${msg.content}</div>
                    <div class="message-time">${new Date(msg.timestamp).toLocaleTimeString()}</div>
                `;
                
                chatMessages.appendChild(messageDiv);
            });
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Send chat message
        async function sendChatMessage() {
            if (!chatPartner || !currentUser) return;
            
            const input = document.getElementById('chat-message-input');
            const message = input.value.trim();
            if (!message) return;
            
            const newMessage = {
                id: generateId(),
                senderId: currentUser.id,
                receiverId: chatPartner.id,
                content: message,
                timestamp: new Date().toISOString(),
                read: false
            };
            
            try {
                await addToDB('messages', newMessage);
                
                // Add to chat UI
                const chatMessages = document.getElementById('chat-messages');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message message-sent sent';
                messageDiv.innerHTML = `
                    <div class="message-content">${message}</div>
                    <div class="message-time">${new Date().toLocaleTimeString()}</div>
                `;
                chatMessages.appendChild(messageDiv);
                
                // Clear input
                input.value = '';
                
                // Scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Send to network
                sendMessage({
                    type: 'message',
                    message: newMessage
                });
            } catch (error) {
                console.error('Error sending message:', error);
                showToast('Failed to send message', 'error');
            }
        }

        // Ask about jobs
        function askAboutJobs(userId) {
            const peer = Object.values(peers).find(p => p.id === userId);
            if (!peer) return;
            
            startChat(userId);
            
            // Pre-fill message
            setTimeout(() => {
                document.getElementById('chat-message-input').value = 'Hi, do you have any job opportunities available?';
            }, 100);
        }

        // Switch admin tab
        function switchAdminTab(tabId) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelector(`.tab[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(`${tabId}-tab`).classList.add('active');
            
            switch(tabId) {
                case 'reports':
                    loadAdminReports();
                    break;
                case 'users':
                    loadAdminUsers();
                    break;
                case 'jobs':
                    loadAdminJobs();
                    break;
                case 'settings':
                    loadAdminSettings();
                    break;
            }
        }

        // Load admin reports
        async function loadAdminReports() {
            const reports = await getAllFromDB('reports');
            const jobs = await getAllFromDB('jobs');
            const users = await getAllFromDB('users');
            
            const reportsList = document.getElementById('reports-list');
            reportsList.innerHTML = '';
            
            if (reports.length === 0) {
                reportsList.innerHTML = '<p>No reports found</p>';
                return;
            }
            
            reports.forEach(report => {
                const job = jobs.find(j => j.id === report.jobId);
                const reporter = users.find(u => u.id === report.reporterId);
                const reportedUser = users.find(u => u.id === (job ? job.posterId : null));
                
                if (!job || !reporter) return;
                
                const reportDiv = document.createElement('div');
                reportDiv.className = 'job-card';
                
                reportDiv.innerHTML = `
                    <h3>Report on: ${job.title}</h3>
                    <p>Reported by: ${reporter.name || reporter.username}</p>
                    <p>Reason: ${report.reason}</p>
                    <p>Details: ${report.details}</p>
                    <p>Reported on: ${new Date(report.timestamp).toLocaleDateString()}</p>
                    <div class="job-actions">
                        <button class="btn btn-primary review-btn" data-report-id="${report.id}">Review</button>
                        <button class="btn btn-secondary chat-btn" data-user-id="${reportedUser?.id || ''}">Chat with Poster</button>
                        <button class="btn btn-danger ban-btn" data-user-id="${reportedUser?.id || ''}">Ban User</button>
                        <button class="btn btn-success approve-btn" data-job-id="${job.id}">Approve Job</button>
                    </div>
                `;
                
                reportsList.appendChild(reportDiv);
            });
            
            // Add event listeners to buttons
            document.querySelectorAll('.review-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const reportId = this.getAttribute('data-report-id');
                    reviewReport(reportId);
                });
            });
            
            document.querySelectorAll('.chat-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const userId = this.getAttribute('data-user-id');
                    if (userId) startChat(userId);
                });
            });
            
            document.querySelectorAll('.ban-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const userId = this.getAttribute('data-user-id');
                    if (userId) banUser(userId);
                });
            });
            
            document.querySelectorAll('.approve-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const jobId = this.getAttribute('data-job-id');
                    approveJob(jobId);
                });
            });
        }

        // Load admin users
        async function loadAdminUsers() {
            const users = await getAllFromDB('users');
            const bans = await getAllFromDB('bans');
            
            const usersList = document.getElementById('users-list');
            usersList.innerHTML = '';
            
            if (users.length === 0) {
                usersList.innerHTML = '<p>No users found</p>';
                return;
            }
            
            users.forEach(user => {
                if (user.id === currentUser?.id) return; // Don't show current user
                
                const isBanned = bans.some(ban => ban.userId === user.id);
                
                const userDiv = document.createElement('div');
                userDiv.className = 'job-card';
                
                userDiv.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h3>${user.name || user.username}</h3>
                            <p>${user.profession || ''} at ${user.company || ''}</p>
                            <p>${user.email} | ${user.phone}</p>
                            <p>Joined: ${new Date(user.joinDate).toLocaleDateString()}</p>
                            ${isBanned ? '<span class="badge badge-danger">BANNED</span>' : ''}
                            ${user.blueTick ? '<span class="badge badge-primary">VERIFIED</span>' : ''}
                            ${user.isAdmin ? '<span class="badge badge-success">ADMIN</span>' : ''}
                        </div>
                        <div>
                            <button class="btn btn-primary chat-btn" data-user-id="${user.id}">Chat</button>
                            ${!isBanned ? `<button class="btn btn-danger ban-btn" data-user-id="${user.id}">Ban</button>` : 
                                          `<button class="btn btn-success unban-btn" data-user-id="${user.id}">Unban</button>`}
                            ${!user.isAdmin ? `<button class="btn btn-secondary make-admin-btn" data-user-id="${user.id}">Make Admin</button>` : 
                                            `<button class="btn btn-warning remove-admin-btn" data-user-id="${user.id}">Remove Admin</button>`}
                            ${!user.blueTick ? `<button class="btn btn-info verify-btn" data-user-id="${user.id}">Verify</button>` : 
                                              `<button class="btn btn-warning unverify-btn" data-user-id="${user.id}">Unverify</button>`}
                        </div>
                    </div>
                `;
                
                usersList.appendChild(userDiv);
            });
            
            // Add event listeners to buttons
            document.querySelectorAll('.chat-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const userId = this.getAttribute('data-user-id');
                    startChat(userId);
                });
            });
            
            document.querySelectorAll('.ban-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const userId = this.getAttribute('data-user-id');
                    banUser(userId);
                });
            });
            
            document.querySelectorAll('.unban-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const userId = this.getAttribute('data-user-id');
                    unbanUser(userId);
                });
            });
            
            document.querySelectorAll('.make-admin-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const userId = this.getAttribute('data-user-id');
                    makeAdmin(userId);
                });
            });
            
            document.querySelectorAll('.remove-admin-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const userId = this.getAttribute('data-user-id');
                    removeAdmin(userId);
                });
            });
            
            document.querySelectorAll('.verify-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const userId = this.getAttribute('data-user-id');
                    verifyUser(userId);
                });
            });
            
            document.querySelectorAll('.unverify-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const userId = this.getAttribute('data-user-id');
                    unverifyUser(userId);
                });
            });
        }

        // Load admin jobs
        async function loadAdminJobs() {
            const jobs = await getAllFromDB('jobs');
            const users = await getAllFromDB('users');
            
            const jobsList = document.getElementById('jobs-list-admin');
            jobsList.innerHTML = '';
            
            if (jobs.length === 0) {
                jobsList.innerHTML = '<p>No jobs found</p>';
                return;
            }
            
            jobs.forEach(job => {
                const poster = users.find(u => u.id === job.posterId);
                
                const jobDiv = document.createElement('div');
                jobDiv.className = 'job-card';
                
                const salaryText = job.salaryMin ? 
                    `${formatCurrency(job.salaryMin, job.currency)} - ${formatCurrency(job.salaryMax, job.currency)}` : 
                    'Not disclosed';
                
                const deadline = new Date(job.deadline).toLocaleDateString();
                
                jobDiv.innerHTML = `
                    <h3 class="job-title">${job.title}</h3>
                    <div class="job-company">${job.company} ${job.blueTick ? '<span class="badge badge-primary"></span>' : ''}</div>
                    <div class="job-location"><i class="fas fa-map-marker-alt"></i> ${job.location}</div>
                    <div class="job-deadline"><i class="fas fa-clock"></i> Deadline: ${deadline}</div>
                    <div class="job-salary"><i class="fas fa-money-bill-wave"></i> ${salaryText}</div>
                    <p>Posted by: ${poster?.name || poster?.username || 'Unknown'}</p>
                    <div class="job-actions">
                        <button class="btn btn-danger delete-job-btn" data-job-id="${job.id}">Delete Job</button>
                        ${job.blueTick ? '' : '<button class="btn btn-info verify-job-btn" data-job-id="${job.id}">Verify Job</button>'}
                        <button class="btn btn-secondary chat-btn" data-user-id="${poster?.id || ''}">Chat with Poster</button>
                    </div>
                `;
                
                jobsList.appendChild(jobDiv);
            });
            
            // Add event listeners to buttons
            document.querySelectorAll('.delete-job-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const jobId = this.getAttribute('data-job-id');
                    if (confirm('Are you sure you want to delete this job?')) {
                        deleteJob(jobId);
                    }
                });
            });
            
            document.querySelectorAll('.verify-job-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const jobId = this.getAttribute('data-job-id');
                    verifyJob(jobId);
                });
            });
            
            document.querySelectorAll('.chat-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const userId = this.getAttribute('data-user-id');
                    if (userId) startChat(userId);
                });
            });
        }

        // Load admin settings
        async function loadAdminSettings() {
            const settings = await getFromDB('settings', 'admin');
            
            if (settings) {
                document.getElementById('app-name').value = settings.appName || 'Skysoft Job Market';
                document.getElementById('admin-email').value = settings.adminEmail || '';
                document.getElementById('system-email').value = settings.systemEmail || '';
                document.getElementById('blue-tick-threshold').value = settings.blueTickThreshold || 100;
                document.getElementById('ban-duration').value = settings.banDuration || 12;
                document.getElementById('code-tamper-ban').value = settings.codeTamperBan || 1;
                document.getElementById('admin-inactivity').value = settings.adminInactivity || 6;
                document.getElementById('successor-email').value = settings.successorEmail || '';
                document.getElementById('successor-phone').value = settings.successorPhone || '';
            }
        }

        // Review report
        async function reviewReport(reportId) {
            const report = await getFromDB('reports', reportId);
            if (!report) return;
            
            const job = await getFromDB('jobs', report.jobId);
            if (!job) return;
            
            // Mark job as under review
            job.underReview = true;
            await updateDB('jobs', job);
            
            showToast('Job marked as under review', 'success');
            loadAdminReports();
        }

        // Ban user
        async function banUser(userId) {
            if (!confirm('Are you sure you want to ban this user?')) return;
            
            const settings = await getFromDB('settings', 'admin');
            const banDuration = settings?.banDuration || 12;
            
            const ban = {
                id: generateId(),
                userId: userId,
                banDate: new Date().toISOString(),
                banUntil: new Date(new Date().setMonth(new Date().getMonth() + banDuration)).toISOString(),
                reason: 'Reported job'
            };
            
            try {
                await addToDB('bans', ban);
                
                // Update user status
                const user = await getFromDB('users', userId);
                if (user) {
                    user.banned = true;
                    await updateDB('users', user);
                }
                
                showToast('User banned successfully', 'success');
                loadAdminUsers();
            } catch (error) {
                console.error('Error banning user:', error);
                showToast('Failed to ban user', 'error');
            }
        }

        // Unban user
        async function unbanUser(userId) {
            if (!confirm('Are you sure you want to unban this user?')) return;
            
            try {
                // Find and remove ban
                const bans = await getAllFromDB('bans');
                const userBan = bans.find(ban => ban.userId === userId);
                
                if (userBan) {
                    await deleteFromDB('bans', userBan.id);
                }
                
                // Update user status
                const user = await getFromDB('users', userId);
                if (user) {
                    user.banned = false;
                    await updateDB('users', user);
                }
                
                showToast('User unbanned successfully', 'success');
                loadAdminUsers();
            } catch (error) {
                console.error('Error unbanning user:', error);
                showToast('Failed to unban user', 'error');
            }
        }

        // Make admin
        async function makeAdmin(userId) {
            if (!confirm('Are you sure you want to make this user an admin?')) return;
            
            try {
                const user = await getFromDB('users', userId);
                if (user) {
                    user.isAdmin = true;
                    await updateDB('users', user);
                    
                    showToast('User is now an admin', 'success');
                    loadAdminUsers();
                }
            } catch (error) {
                console.error('Error making user admin:', error);
                showToast('Failed to make user admin', 'error');
            }
        }

        // Remove admin
        async function removeAdmin(userId) {
            if (!confirm('Are you sure you want to remove admin privileges from this user?')) return;
            
            try {
                const user = await getFromDB('users', userId);
                if (user) {
                    user.isAdmin = false;
                    await updateDB('users', user);
                    
                    showToast('Admin privileges removed', 'success');
                    loadAdminUsers();
                }
            } catch (error) {
                console.error('Error removing admin:', error);
                showToast('Failed to remove admin', 'error');
            }
        }

        // Verify user
        async function verifyUser(userId) {
            try {
                const user = await getFromDB('users', userId);
                if (user) {
                    user.blueTick = true;
                    await updateDB('users', user);
                    
                    showToast('User verified', 'success');
                    loadAdminUsers();
                }
            } catch (error) {
                console.error('Error verifying user:', error);
                showToast('Failed to verify user', 'error');
            }
        }

        // Unverify user
        async function unverifyUser(userId) {
            try {
                const user = await getFromDB('users', userId);
                if (user) {
                    user.blueTick = false;
                    await updateDB('users', user);
                    
                    showToast('User unverified', 'success');
                    loadAdminUsers();
                }
            } catch (error) {
                console.error('Error unverifying user:', error);
                showToast('Failed to unverify user', 'error');
            }
        }

        // Verify job
        async function verifyJob(jobId) {
            try {
                const job = await getFromDB('jobs', jobId);
                if (job) {
                    job.blueTick = true;
                    await updateDB('jobs', job);
                    
                    showToast('Job verified', 'success');
                    loadAdminJobs();
                }
            } catch (error) {
                console.error('Error verifying job:', error);
                showToast('Failed to verify job', 'error');
            }
        }

        // Approve job
        async function approveJob(jobId) {
            try {
                const job = await getFromDB('jobs', jobId);
                if (job) {
                    job.underReview = false;
                    job.blueTick = true;
                    await updateDB('jobs', job);
                    
                    showToast('Job approved and verified', 'success');
                    loadAdminReports();
                }
            } catch (error) {
                console.error('Error approving job:', error);
                showToast('Failed to approve job', 'error');
            }
        }

        // Handle admin settings form
        async function handleAdminSettings(e) {
            e.preventDefault();
            
            const settings = {
                id: 'admin',
                appName: document.getElementById('app-name').value,
                adminEmail: document.getElementById('admin-email').value,
                systemEmail: document.getElementById('system-email').value,
                blueTickThreshold: parseInt(document.getElementById('blue-tick-threshold').value),
                banDuration: parseInt(document.getElementById('ban-duration').value),
                codeTamperBan: parseInt(document.getElementById('code-tamper-ban').value),
                adminInactivity: parseInt(document.getElementById('admin-inactivity').value),
                successorEmail: document.getElementById('successor-email').value,
                successorPhone: document.getElementById('successor-phone').value
            };
            
            try {
                await addToDB('settings', settings);
                showToast('Settings saved successfully', 'success');
            } catch (error) {
                console.error('Error saving settings:', error);
                showToast('Failed to save settings', 'error');
            }
        }

        // Export database
        async function exportDatabase() {
            try {
                const data = {
                    users: await getAllFromDB('users'),
                    jobs: await getAllFromDB('jobs'),
                    applications: await getAllFromDB('applications'),
                    messages: await getAllFromDB('messages'),
                    reports: await getAllFromDB('reports'),
                    settings: await getAllFromDB('settings'),
                    categories: await getAllFromDB('categories'),
                    bans: await getAllFromDB('bans'),
                    companies: await getAllFromDB('companies')
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `skysoft-job-market-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showToast('Database exported successfully', 'success');
            } catch (error) {
                console.error('Error exporting database:', error);
                showToast('Failed to export database', 'error');
            }
        }

        // Import database
        async function importDatabase(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            if (!confirm('WARNING: This will overwrite all current data. Are you sure?')) return;
            
            const reader = new FileReader();
            reader.onload = async function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Clear all existing data
                    const stores = [
                        'users', 'jobs', 'applications', 'messages', 
                        'reports', 'settings', 'categories', 'bans', 'companies'
                    ];
                    
                    for (const store of stores) {
                        const items = await getAllFromDB(store);
                        for (const item of items) {
                            await deleteFromDB(store, item.id);
                        }
                    }
                    
                    // Import new data
                    if (data.users) {
                        for (const user of data.users) {
                            await addToDB('users', user);
                        }
                    }
                    
                    if (data.jobs) {
                        for (const job of data.jobs) {
                            await addToDB('jobs', job);
                        }
                    }
                    
                    if (data.applications) {
                        for (const app of data.applications) {
                            await addToDB('applications', app);
                        }
                    }
                    
                    if (data.messages) {
                        for (const msg of data.messages) {
                            await addToDB('messages', msg);
                        }
                    }
                    
                    if (data.reports) {
                        for (const report of data.reports) {
                            await addToDB('reports', report);
                        }
                    }
                    
                    if (data.settings) {
                        for (const setting of data.settings) {
                            await addToDB('settings', setting);
                        }
                    }
                    
                    if (data.categories) {
                        for (const category of data.categories) {
                            await addToDB('categories', category);
                        }
                    }
                    
                    if (data.bans) {
                        for (const ban of data.bans) {
                            await addToDB('bans', ban);
                        }
                    }
                    
                    if (data.companies) {
                        for (const company of data.companies) {
                            await addToDB('companies', company);
                        }
                    }
                    
                    showToast('Database imported successfully', 'success');
                    location.reload();
                } catch (error) {
                    console.error('Error importing database:', error);
                    showToast('Failed to import database', 'error');
                }
            };
            reader.readAsText(file);
        }

        // Send system message
        function sendSystemMessage() {
            const message = document.getElementById('system-message').value.trim();
            if (!message) return;
            
            sendMessage({
                type: 'system',
                message: message
            });
            
            document.getElementById('system-message').value = '';
            showToast('Message broadcasted to all users', 'success');
        }

        // Handle login
        async function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            
            try {
                const users = await getAllFromDB('users');
                const user = users.find(u => 
                    (u.username === username || u.phone === username) && 
                    u.password === hashPassword(password) // In a real app, use proper password hashing
                );
                
                if (user) {
                    // Check if user is banned
                    const bans = await getAllFromDB('bans');
                    const userBan = bans.find(ban => ban.userId === user.id && new Date(ban.banUntil) > new Date());
                    
                    if (userBan) {
                        showToast(`You are banned until ${new Date(userBan.banUntil).toLocaleDateString()}`, 'error');
                        return;
                    }
                    
                    // Set current user
                    currentUser = user;
                    isAdmin = user.isAdmin || false;
                    
                    // Save to DB
                    await addToDB('currentUser', user);
                    
                    // Update UI
                    hideModal('login-modal');
                    showDashboard();
                    showToast('Login successful', 'success');
                    
                    // Update online status
                    updateUserOnlineStatus(true);
                    
                    // If this is the first user, make them admin
                    if (users.length === 1 && !user.isAdmin) {
                        user.isAdmin = true;
                        isAdmin = true;
                        await updateDB('users', user);
                        await addToDB('currentUser', user);
                        showToast('You are now the admin as the first user', 'info');
                    }
                } else {
                    showToast('Invalid username or password', 'error');
                }
            } catch (error) {
                console.error('Error logging in:', error);
                showToast('Failed to login', 'error');
            }
        }

        // Handle signup
        async function handleSignup(e) {
            e.preventDefault();
            
            const name = document.getElementById('signup-fullname').value;
            const username = document.getElementById('signup-username').value;
            const email = document.getElementById('signup-email').value;
            const phone = document.getElementById('signup-phone').value;
            const password = document.getElementById('signup-password').value;
            const confirmPassword = document.getElementById('signup-confirm-password').value;
            const profession = document.getElementById('signup-profession').value;
            const jobTitle = document.getElementById('signup-job-title').value;
            const company = document.getElementById('signup-company').value;
            
            if (password !== confirmPassword) {
                showToast('Passwords do not match', 'error');
                return;
            }
            
            try {
                // Check if username, email or phone already exists
                const users = await getAllFromDB('users');
                
                if (users.some(u => u.username === username)) {
                    showToast('Username already taken', 'error');
                    return;
                }
                
                if (users.some(u => u.email === email)) {
                    showToast('Email already registered', 'error');
                    return;
                }
                
                if (users.some(u => u.phone === phone)) {
                    showToast('Phone number already registered', 'error');
                    return;
                }
                
                // Create new user
                const newUser = {
                    id: generateId(),
                    name: name,
                    username: username,
                    email: email,
                    phone: phone,
                    password: hashPassword(password), // In a real app, use proper password hashing
                    profession: profession,
                    jobTitle: jobTitle,
                    company: company,
                    joinDate: new Date().toISOString(),
                    isAdmin: users.length === 0, // First user becomes admin
                    blueTick: false,
                    location: '',
                    avatar: ''
                };
                
                // Save user
                await addToDB('users', newUser);
                
                // Set current user
                currentUser = newUser;
                isAdmin = newUser.isAdmin;
                
                // Save to DB
                await addToDB('currentUser', newUser);
                
                // Update UI
                hideModal('signup-modal');
                showDashboard();
                showToast('Account created successfully', 'success');
                
                // Update online status
                updateUserOnlineStatus(true);
                
                // If this is the first user, show admin message
                if (users.length === 0) {
                    showToast('You are the first user and have been made admin', 'info');
                }
                
            } catch (error) {
                console.error('Error signing up:', error);
                showToast('Failed to create account', 'error');
            }
        }

        // Handle forgot password
        async function handleForgotPassword(e) {
            e.preventDefault();
            
            const emailOrPhone = document.getElementById('reset-email').value;
            
            // TODO: Implement proper password reset with email/SMS
            showToast('Password reset feature coming soon', 'info');
            hideModal('forgot-password-modal');
        }

        // Handle verify email
        async function handleVerifyEmail(e) {
            e.preventDefault();
            
            const code = document.getElementById('verification-code').value;
            
            // TODO: Implement proper email verification
            showToast('Email verification feature coming soon', 'info');
            hideModal('verify-email-modal');
        }

        // Handle post job
        async function handlePostJob(e) {
            e.preventDefault();
            
            if (!currentUser) {
                showModal('login-modal');
                return;
            }
            
            const title = document.getElementById('job-title').value;
            const positions = parseInt(document.getElementById('job-positions').value);
            const company = document.getElementById('job-company').value;
            const category = document.getElementById('job-category').value;
            const location = document.getElementById('job-location').value;
            const deadline = document.getElementById('job-deadline').value;
            const salaryMin = document.getElementById('job-salary-min').value;
            const salaryMax = document.getElementById('job-salary-max').value;
            const currency = document.getElementById('job-salary-currency').value;
            const description = document.getElementById('job-description').value;
            const allowComments = document.getElementById('allow-comments').checked;
            const allowPrivateMessages = document.getElementById('allow-private-messages').checked;
            
            // Get image file if any
            const imageFile = document.getElementById('job-image').files[0];
            let imageUrl = '';
            
            if (imageFile) {
                // In a real app, upload to IPFS or similar
                imageUrl = await uploadFile(imageFile);
            }
            
            try {
                const newJob = {
                    id: generateId(),
                    title: title,
                    positions: positions,
                    company: company,
                    category: category,
                    location: location,
                    deadline: deadline,
                    salaryMin: salaryMin ? parseInt(salaryMin) : null,
                    salaryMax: salaryMax ? parseInt(salaryMax) : null,
                    currency: currency || defaultCurrency,
                    description: description,
                    posterId: currentUser.id,
                    postedDate: new Date().toISOString(),
                    allowComments: allowComments,
                    allowPrivateMessages: allowPrivateMessages,
                    image: imageUrl,
                    blueTick: false,
                    underReview: false
                };
                
                // Save job
                await addToDB('jobs', newJob);
                
                // Broadcast to network
                sendMessage({
                    type: 'job',
                    job: newJob
                });
                
                // Update UI
                hideModal('post-job-modal');
                showToast('Job posted successfully', 'success');
                loadMyJobs();
                
            } catch (error) {
                console.error('Error posting job:', error);
                showToast('Failed to post job', 'error');
            }
        }

        // Handle apply job
        async function handleApplyJob(e) {
            e.preventDefault();
            
            if (!currentUser || !currentJob) return;
            
            const name = document.getElementById('applicant-name').value;
            const email = document.getElementById('applicant-email').value;
            const phone = document.getElementById('applicant-phone').value;
            const age = parseInt(document.getElementById('applicant-age').value);
            const gender = document.getElementById('applicant-gender').value;
            const location = document.getElementById('applicant-location').value;
            const experience = parseInt(document.getElementById('applicant-experience').value);
            const qualifications = document.getElementById('applicant-qualifications').value;
            
            // Get files
            const photoFile = document.getElementById('applicant-photo').files[0];
            const cvFile = document.getElementById('applicant-cv').files[0];
            
            let photoUrl = '';
            let cvUrl = '';
            
            if (photoFile) {
                photoUrl = await uploadFile(photoFile);
            }
            
            if (cvFile) {
                cvUrl = await uploadFile(cvFile);
            }
            
            try {
                const newApplication = {
                    id: generateId(),
                    jobId: currentJob,
                    applicantId: currentUser.id,
                    name: name,
                    email: email,
                    phone: phone,
                    age: age,
                    gender: gender,
                    location: location,
                    experience: experience,
                    qualifications: qualifications,
                    photo: photoUrl,
                    cv: cvUrl,
                    appliedDate: new Date().toISOString(),
                    status: 'pending',
                    interviewDate: null,
                    interviewLocation: null,
                    interviewOnline: false
                };
                
                // Save application
                await addToDB('applications', newApplication);
                
                // Broadcast to network
                sendMessage({
                    type: 'application',
                    application: newApplication
                });
                
                // Update UI
                hideModal('apply-job-modal');
                showToast('Application submitted successfully', 'success');
                loadMyApplications();
                
            } catch (error) {
                console.error('Error applying for job:', error);
                showToast('Failed to submit application', 'error');
            }
        }

        // Handle report job
        async function handleReportJob(e) {
            e.preventDefault();
            
            if (!currentUser || !currentJob) return;
            
            const reason = document.getElementById('report-reason').value;
            const details = document.getElementById('report-details').value;
            
            // Get files
            const screenshotFiles = document.getElementById('report-screenshot').files;
            const audioFile = document.getElementById('report-audio').files[0];
            
            let screenshots = [];
            let audioUrl = '';
            
            if (screenshotFiles && screenshotFiles.length > 0) {
                for (let i = 0; i < screenshotFiles.length; i++) {
                    const url = await uploadFile(screenshotFiles[i]);
                    screenshots.push(url);
                }
            }
            
            if (audioFile) {
                audioUrl = await uploadFile(audioFile);
            }
            
            try {
                const newReport = {
                    id: generateId(),
                    jobId: currentJob,
                    reporterId: currentUser.id,
                    reason: reason,
                    details: details,
                    screenshots: screenshots,
                    audio: audioUrl,
                    timestamp: new Date().toISOString(),
                    status: 'pending'
                };
                
                // Save report
                await addToDB('reports', newReport);
                
                // Broadcast to network
                sendMessage({
                    type: 'report',
                    report: newReport
                });
                
                // Update UI
                hideModal('report-job-modal');
                showToast('Report submitted successfully', 'success');
                
            } catch (error) {
                console.error('Error submitting report:', error);
                showToast('Failed to submit report', 'error');
            }
        }

        // Handle logout
        async function handleLogout() {
            try {
                // Update online status
                await updateUserOnlineStatus(false);
                
                // Remove current user
                await deleteFromDB('currentUser', currentUser.id);
                
                // Reset state
                currentUser = null;
                isAdmin = false;
                
                // Update UI
                showWelcome();
                showToast('Logged out successfully', 'success');
                
            } catch (error) {
                console.error('Error logging out:', error);
                showToast('Failed to logout', 'error');
            }
        }

        // Update user online status
        async function updateUserOnlineStatus(online) {
            if (!currentUser) return;
            
            try {
                currentUser.online = online;
                await updateDB('users', currentUser);
                await addToDB('currentUser', currentUser);
                
                // Broadcast to network
                broadcastPresence();
            } catch (error) {
                console.error('Error updating online status:', error);
            }
        }

        // Add or update job in DB
        async function addOrUpdateJob(job) {
            try {
                const existing = await getFromDB('jobs', job.id);
                if (existing) {
                    await updateDB('jobs', job);
                } else {
                    await addToDB('jobs', job);
                }
                
                // Update UI if on jobs page
                if (document.getElementById('content-title').textContent.includes('Jobs')) {
                    loadDashboard();
                }
            } catch (error) {
                console.error('Error adding/updating job:', error);
            }
        }

        // Add or update application in DB
        async function addOrUpdateApplication(application) {
            try {
                const existing = await getFromDB('applications', application.id);
                if (existing) {
                    await updateDB('applications', application);
                } else {
                    await addToDB('applications', application);
                }
                
                // Update UI if on applications page
                if (document.getElementById('content-title').textContent.includes('Applications')) {
                    loadMyApplications();
                }
            } catch (error) {
                console.error('Error adding/updating application:', error);
            }
        }

        // Add or update report in DB
        async function addOrUpdateReport(report) {
            try {
                const existing = await getFromDB('reports', report.id);
                if (existing) {
                    await updateDB('reports', report);
                } else {
                    await addToDB('reports', report);
                }
                
                // Update UI if on admin reports page
                if (document.querySelector('.tab.active[data-tab="reports"]')) {
                    loadAdminReports();
                }
            } catch (error) {
                console.error('Error adding/updating report:', error);
            }
        }

        // Update user in DB
        async function updateUser(user) {
            try {
                const existing = await getFromDB('users', user.id);
                if (existing) {
                    await updateDB('users', user);
                    
                    // If it's the current user, update state
                    if (currentUser && currentUser.id === user.id) {
                        currentUser = user;
                        await addToDB('currentUser', user);
                        
                        // Update UI
                        showDashboard();
                    }
                } else {
                    await addToDB('users', user);
                }
                
                // Update online users list
                updateOnlineUsersList();
            } catch (error) {
                console.error('Error updating user:', error);
            }
        }

        // Add message to DB
        async function addMessage(message) {
            try {
                await addToDB('messages', message);
                
                // If chat is open with this user, update UI
                if (chatPartner && (message.senderId === chatPartner.id || message.receiverId === chatPartner.id)) {
                    loadChatHistory(chatPartner.id);
                }
            } catch (error) {
                console.error('Error adding message:', error);
            }
        }

        // Check username availability
        async function checkUsernameAvailability() {
            const username = document.getElementById('signup-username').value.trim();
            if (!username) return;
            
            try {
                const users = await getAllFromDB('users');
                const isAvailable = !users.some(u => u.username === username);
                
                const availabilityMsg = document.getElementById('username-availability');
                if (isAvailable) {
                    availabilityMsg.textContent = 'Username is available';
                    availabilityMsg.style.color = 'green';
                } else {
                    availabilityMsg.textContent = 'Username is already taken';
                    availabilityMsg.style.color = 'red';
                }
            } catch (error) {
                console.error('Error checking username:', error);
            }
        }

        // Detect user location
        async function detectLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        const { latitude, longitude } = position.coords;
                        
                        // In a real app, you would use a geocoding service to get country/city
                        // For demo purposes, we'll just store coordinates
                        if (currentUser) {
                            currentUser.location = `${latitude}, ${longitude}`;
                            await updateDB('users', currentUser);
                            await addToDB('currentUser', currentUser);
                        }
                    },
                    (error) => {
                        console.error('Error getting location:', error);
                    }
                );
            }
        }

        // Load currency rates
        async function loadCurrencyRates() {
            try {
                // In a real app, you would fetch from a currency API
                // For demo, we'll use hardcoded rates
                currencyRates = {
                    USD: 1,
                    UGX: 3700,
                    KES: 110,
                    TZS: 2300,
                    RWF: 1000
                };
                
                // Set default currency based on location
                // For demo, we'll default to UGX
                defaultCurrency = 'UGX';
                
                // Update currency dropdowns
                const currencySelects = document.querySelectorAll('select[id$="currency"]');
                currencySelects.forEach(select => {
                    select.innerHTML = '';
                    for (const [code, rate] of Object.entries(currencyRates)) {
                        const option = document.createElement('option');
                        option.value = code;
                        option.textContent = code;
                        if (code === defaultCurrency) {
                            option.selected = true;
                        }
                        select.appendChild(option);
                    }
                });
                
            } catch (error) {
                console.error('Error loading currency rates:', error);
            }
        }

        // Format currency
        function formatCurrency(amount, currency) {
            const symbol = countries[currency]?.symbol || currency;
            return `${symbol} ${amount.toLocaleString()}`;
        }

        // Upload file (mock implementation)
        async function uploadFile(file) {
            // In a real app, you would upload to IPFS or similar
            return new Promise(resolve => {
                setTimeout(() => {
                    resolve(`https://example.com/uploads/${file.name}`);
                }, 500);
            });
        }

        // Generate random ID
        function generateId() {
            return Math.random().toString(36).substr(2, 9);
        }

        // Simple password hashing (in a real app, use proper hashing like bcrypt)
        function hashPassword(password) {
            return password.split('').reverse().join(''); // Just for demo!
        }

        // IndexedDB helper functions
        function getFromDB(storeName, key) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readonly');
                const store = transaction.objectStore(storeName);
                const request = store.get(key);
                
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }
        
        function getAllFromDB(storeName) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readonly');
                const store = transaction.objectStore(storeName);
                const request = store.getAll();
                
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }
        
        function addToDB(storeName, data) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.add(data);
                
                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        }
        
        function updateDB(storeName, data) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.put(data);
                
                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        }
        
        function deleteFromDB(storeName, key) {
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                const request = store.delete(key);
                
                request.onsuccess = () => resolve();
                request.onerror = () => reject(request.error);
            });
        }

        // WebRTC functions for video interviews
        async function startInterview(peerId) {
            try {
                currentInterview = peerId;
                
                // Get local stream
                localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                document.getElementById('local-video').srcObject = localStream;
                
                // Create peer connection
                peerConnection = new RTCPeerConnection();
                
                // Add local stream to connection
                localStream.getTracks().forEach(track => {
                    peerConnection.addTrack(track, localStream);
                });
                
                // Set up remote stream
                const remoteStream = new MediaStream();
                document.getElementById('remote-video').srcObject = remoteStream;
                
                // Listen for remote tracks
                peerConnection.ontrack = (event) => {
                    event.streams[0].getTracks().forEach(track => {
                        remoteStream.addTrack(track);
                    });
                };
                
                // Create data channel for signaling
                dataChannel = peerConnection.createDataChannel('chat');
                
                // Set up ICE candidates
                peerConnection.onicecandidate = (event) => {
                    if (event.candidate) {
                        // Send candidate to remote peer
                        sendMessage({
                            type: 'ice-candidate',
                            candidate: event.candidate,
                            peerId: peerId
                        });
                    }
                };
                
                // Create offer
                const offer = await peerConnection.createOffer();
                await peerConnection.setLocalDescription(offer);
                
                // Send offer to remote peer
                sendMessage({
                    type: 'offer',
                    offer: offer,
                    peerId: peerId
                });
                
                showModal('interview-modal');
                
            } catch (error) {
                console.error('Error starting interview:', error);
                showToast('Failed to start interview', 'error');
            }
        }
        
        async function handleOffer(offer, peerId) {
            try {
                currentInterview = peerId;
                
                // Get local stream
                localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                document.getElementById('local-video').srcObject = localStream;
                
                // Create peer connection
                peerConnection = new RTCPeerConnection();
                
                // Add local stream to connection
                localStream.getTracks().forEach(track => {
                    peerConnection.addTrack(track, localStream);
                });
                
                // Set up remote stream
                const remoteStream = new MediaStream();
                document.getElementById('remote-video').srcObject = remoteStream;
                
                // Listen for remote tracks
                peerConnection.ontrack = (event) => {
                    event.streams[0].getTracks().forEach(track => {
                        remoteStream.addTrack(track);
                    });
                };
                
                // Listen for data channel
                peerConnection.ondatachannel = (event) => {
                    dataChannel = event.channel;
                };
                
                // Set up ICE candidates
                peerConnection.onicecandidate = (event) => {
                    if (event.candidate) {
                        // Send candidate to remote peer
                        sendMessage({
                            type: 'ice-candidate',
                            candidate: event.candidate,
                            peerId: peerId
                        });
                    }
                };
                
                // Set remote description
                await peerConnection.setRemoteDescription(new RTCSessionDescription(offer));
                
                // Create answer
                const answer = await peerConnection.createAnswer();
                await peerConnection.setLocalDescription(answer);
                
                // Send answer to remote peer
                sendMessage({
                    type: 'answer',
                    answer: answer,
                    peerId: peerId
                });
                
                showModal('interview-modal');
                
            } catch (error) {
                console.error('Error handling offer:', error);
                showToast('Failed to handle interview offer', 'error');
            }
        }
        
        async function handleAnswer(answer) {
            try {
                await peerConnection.setRemoteDescription(new RTCSessionDescription(answer));
            } catch (error) {
                console.error('Error handling answer:', error);
                showToast('Failed to handle interview answer', 'error');
            }
        }
        
        async function handleIceCandidate(candidate) {
            try {
                await peerConnection.addIceCandidate(new RTCIceCandidate(candidate));
            } catch (error) {
                console.error('Error handling ICE candidate:', error);
                showToast('Failed to handle ICE candidate', 'error');
            }
        }
        
        function toggleAudio() {
            if (localStream) {
                const audioTrack = localStream.getAudioTracks()[0];
                if (audioTrack) {
                    audioTrack.enabled = !audioTrack.enabled;
                    document.getElementById('mute-audio-btn').innerHTML = 
                        audioTrack.enabled ? '<i class="fas fa-microphone"></i>' : '<i class="fas fa-microphone-slash"></i>';
                }
            }
        }
        
        function toggleVideo() {
            if (localStream) {
                const videoTrack = localStream.getVideoTracks()[0];
                if (videoTrack) {
                    videoTrack.enabled = !videoTrack.enabled;
                    document.getElementById('mute-video-btn').innerHTML = 
                        videoTrack.enabled ? '<i class="fas fa-video"></i>' : '<i class="fas fa-video-slash"></i>';
                }
            }
        }
        
        function endCall() {
            if (localStream) {
                localStream.getTracks().forEach(track => track.stop());
                localStream = null;
            }
            
            if (peerConnection) {
                peerConnection.close();
                peerConnection = null;
            }
            
            dataChannel = null;
            currentInterview = null;
            
            hideModal('interview-modal');
        }
    </script>
</body>
</html>
